{% extends 'base.html.twig' %}

{% block title %}Ajustement de Stock{% endblock %}

{% block body %}
    <div class="container mt-4">
        <h1>Ajustement de Stock</h1>
        <p class="text-muted">Utilisez ce formulaire pour corriger manuellement la quantité d'un lot spécifique (ex: après un inventaire).</p>
        <hr>

        {{ form_start(form, {'attr': {'id': 'ajustement-form'}}) }}
            <div class="row">
                <div class="col-md-6">
                    {{ form_row(form.produit) }}
                </div>
                <div class="col-md-6">
                    {{ form_row(form.lot) }}
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-md-6">
                    {{ form_row(form.nouvelleQuantite) }}
                </div>
                <div class="col-md-6">
                    {{ form_row(form.motif) }}
                </div>
            </div>

            <div class="mt-4">
                <button type="submit" class="btn btn-warning">Valider l'ajustement</button>
                <a href="{{ path('app_stock_index') }}" class="btn btn-secondary">Annuler</a>
            </div>
        {{ form_end(form) }}
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const produitSelect = document.querySelector('.js-produit-select');
            const form = document.getElementById('ajustement-form');

            produitSelect.addEventListener('change', function() {
                const data = new FormData(form);
                const url = window.location.href;

                fetch(url, {
                    method: 'POST',
                    body: data
                })
                .then(response => response.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const newLotSelect = doc.querySelector('.js-lot-select');
                    const currentLotSelect = document.querySelector('.js-lot-select');
                    
                    if (newLotSelect && currentLotSelect) {
                        currentLotSelect.innerHTML = newLotSelect.innerHTML;
                    }
                });
            });
        });
    </script>
{% endblock %}
