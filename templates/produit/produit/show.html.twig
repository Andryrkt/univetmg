{% extends 'base.html.twig' %}

{% block title %}Détail du Produit{% endblock %}

{% block body %}
    <h1>Détail du Produit</h1>

    <table class="table table-bordered mt-4">
        <tbody>
            <tr><th style="width: 25%;">Id</th><td>{{ produit.id }}</td></tr>
            <tr><th>Nom</th><td>{{ produit.nom }}</td></tr>
            <tr><th>Description</th><td>{{ produit.description }}</td></tr>
            <tr><th>Code</th><td>{{ produit.code }}</td></tr>
            <tr><th>Stock Actuel</th><td>{{ produit.quantiteEnStock }}</td></tr> {# Changed from Stock Initial #}
            <tr><th>Stock Minimum</th><td>{{ produit.stockMinimum }}</td></tr>
            <tr><th>Prix Vente</th><td>{{ produit.prixVente|number_format(2, ',', ' ') }} Ar</td></tr>
            <tr>
                <th>Créé le</th>
                <td>{{ produit.createdAt ? produit.createdAt|date('d/m/Y H:i') : '' }}</td>
            </tr>
            <tr>
                <th>Modifié le</th>
                <td>{{ produit.updatedAt ? produit.updatedAt|date('d/m/Y H:i') : '' }}</td>
            </tr>
            <tr><th>Fournisseur</th><td>{{ produit.fournisseur ? produit.fournisseur.nom : '' }}</td></tr>
            <tr><th>Catégorie</th><td>{{ categoryPath ?? 'N/A' }}</td></tr>
            <tr><th>Unité de base</th><td>{{ produit.uniteDeBase ? produit.uniteDeBase.nom : '' }}</td></tr>
        </tbody>
    </table>

    {% if produit.lots is not empty %} {# Added #}
        <h2 class="mt-4">Lots disponibles</h2>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Numéro de Lot</th>
                    <th>Quantité</th>
                    <th>Prix Achat</th>
                    <th>Date Péremption</th>
                </tr>
            </thead>
            <tbody>
                {% for lot in produit.lots %}
                    <tr>
                        <td>{{ lot.numeroLot ?? 'N/A' }}</td>
                        <td>{{ lot.quantite }}</td>
                        <td>{{ lot.prixAchat|number_format(2, ',', ' ') }} Ar</td>
                        <td>{{ lot.datePeremption ? lot.datePeremption|date('Y-m-d') : 'N/A' }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p class="mt-4">Aucun lot disponible pour ce produit.</p>
    {% endif %}

    {% if produit.conditionnements is not empty %}
        <h2 class="mt-4">Conditionnements</h2>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Unité de Conditionnement</th>
                    <th>Quantité (en unité de base)</th>
                </tr>
            </thead>
            <tbody>
                {% for conditionnement in produit.conditionnements %}
                    <tr>
                        <td>{{ conditionnement.unite.nom }}</td>
                        <td>{{ conditionnement.quantite }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p class="mt-4">Aucun conditionnement défini pour ce produit.</p>
    {% endif %}

    <div class="d-flex mt-3">
        <a href="{{ path('app_produit_index') }}" class="btn btn-secondary">Retour à la liste</a>
        <a href="{{ path('app_produit_edit', {'id': produit.id}) }}" class="btn btn-warning ms-2">Modifier</a>
        <div class="ms-auto">
            {{ include('produit/produit/_delete_form.html.twig') }}
        </div>
    </div>

{% endblock %}
