<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Ticket {{ vente.numeroFacture }}</title>
    <style>
        @page {
            margin: 0.5cm;
            size: 80mm auto; /* Thermal printer width */
        }
        body {
            font-family: 'Courier New', monospace;
            font-size: 9pt;
            color: #000;
            width: 72mm;
            margin: 0 auto;
        }
        .center {
            text-align: center;
        }
        .bold {
            font-weight: bold;
        }
        .header {
            text-align: center;
            margin-bottom: 10px;
            border-bottom: 1px dashed #000;
            padding-bottom: 5px;
        }
        .header h1 {
            margin: 5px 0;
            font-size: 14pt;
        }
        .info-line {
            margin: 3px 0;
            font-size: 8pt;
        }
        .separator {
            border-top: 1px dashed #000;
            margin: 8px 0;
        }
        .products-table {
            width: 100%;
            margin: 5px 0;
        }
        .product-line {
            margin: 5px 0;
        }
        .product-name {
            font-weight: bold;
        }
        .product-details {
            display: table;
            width: 100%;
            font-size: 8pt;
        }
        .product-details span {
            display: table-cell;
        }
        .product-details span:last-child {
            text-align: right;
        }
        .total-line {
            display: table;
            width: 100%;
            font-weight: bold;
            font-size: 11pt;
            margin: 5px 0;
            border-top: 1px solid #000;
        }
        .total-line span {
            display: table-cell;
        }
        .total-line span:last-child {
            text-align: right;
        }
        .footer {
            margin-top: 15px;
            text-align: center;
            font-size: 8pt;
            border-top: 1px dashed #000;
            padding-top: 5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>TICKET DE CAISSE</h1>
        <div class="info-line">N° {{ vente.numeroFacture }}</div>
        <div class="info-line">{{ vente.dateVente|date('d/m/Y H:i') }}</div>
    </div>

    <div class="info-line">
        <strong>Client:</strong> {{ vente.client ? vente.client.nom : 'Client de passage' }}
    </div>
    {% if vente.client and vente.client.telephone %}
        <div class="info-line">Tél: {{ vente.client.telephone }}</div>
    {% endif %}
    <div class="info-line">
        <strong>Vendeur:</strong> {{ vente.user ? vente.user.email : 'N/A' }}
    </div>

    <div class="separator"></div>

    <div class="products-table">
        {% for ligne in vente.ligneVentes %}
            <div class="product-line">
                <div class="product-name">{{ ligne.produit.nom }}</div>
                <div class="product-details">
                    <span>
                        {{ ligne.quantite }} {{ ligne.unite ? ligne.unite.nom : ligne.produit.uniteDeBase.nom }} x 
                        {% if ligne.prixCatalogue and ligne.prixCatalogue != ligne.prixUnitaire %}
                            <span style="text-decoration: line-through; font-size: 7pt;">{{ ligne.prixCatalogue|number_format(0, ',', ' ') }}</span>
                        {% endif %}
                        {{ ligne.prixUnitaire|number_format(0, ',', ' ') }} Ar
                    </span>
                    <span>{{ ligne.sousTotal|number_format(0, ',', ' ') }} Ar</span>
                </div>
                {% if ligne.tauxRemise and ligne.tauxRemise > 0 %}
                    <div style="font-size: 7pt; font-style: italic;">Remise: -{{ ligne.tauxRemise }}% ({{ ligne.typeRemise }})</div>
                {% elseif ligne.montantRemise and ligne.montantRemise > 0 %}
                    <div style="font-size: 7pt; font-style: italic;">Remise: -{{ ligne.montantRemise|number_format(0, ',', ' ') }} Ar</div>
                {% endif %}
            </div>
        {% endfor %}
    </div>

    <div class="total-section">
        {% set totalRemise = 0 %}
        {% for ligne in vente.ligneVentes %}
            {% if ligne.montantRemise %}
                {% set totalRemise = totalRemise + (ligne.montantRemise * ligne.quantite) %}
            {% endif %}
        {% endfor %}
        
        {% if totalRemise > 0 %}
        <div class="total-line" style="font-size: 9pt; border-top: none;">
            <span>ÉCONOMIE</span>
            <span>-{{ totalRemise|number_format(0, ',', ' ') }} Ar</span>
        </div>
        {% endif %}
        
        <div class="total-line">
            <span>TOTAL À PAYER</span>
            <span>{{ vente.total|number_format(0, ',', ' ') }} Ar</span>
        </div>
    </div>

    <div class="footer">
        <div>Merci de votre visite</div>
        <div>{{ "now"|date('d/m/Y H:i') }}</div>
        {% if vente.statut.value == 'validee' %}
            <div style="margin-top: 5px;">✓ PAYÉ</div>
        {% elseif vente.statut.value == 'annulee' %}
            <div style="margin-top: 5px;">✗ ANNULÉ</div>
        {% endif %}
    </div>
</body>
</html>
